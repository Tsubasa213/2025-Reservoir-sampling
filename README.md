# リザーバサンプリング可視化ツール

## 1. 概要

- **題材名**: リザーバサンプリング (Reservoir Sampling)
- **開発期間**: 2025年7月17日
- **開発環境**: Google Gemini (Canvas)
- **使用技術**: HTML, CSS (Tailwind CSS), JavaScript
- **Webアプリケーション**: [ここにGemini Canvasの公開リンクを記載]

## 2. アルゴリズムの概要

### リザーバサンプリングとは
リザーバサンプリングは、全体のサイズが不明な、あるいは非常に巨大なデータストリームから、全ての要素をメモリに読み込むことなく、ランダムに k 個の要素を等確率でサンプリングするためのアルゴリズム群です。

### 実装したアルゴリズム (Algorithm R)
本ツールでは、最も基本的なリザーバサンプリングアルゴリズム「Algorithm R」を実装しています：

1. ストリームの最初の k 個の要素を「リザーバ」に格納
2. ストリームの i 番目 (i > k) の要素について：
    - 0 から i-1 までの範囲でランダムな整数 j を生成
    - j < k の場合、リザーバの j 番目の要素を現在のストリーム要素 i で置き換え
    - j が k 以上の場合、何もしない
3. ストリームの最後まで処理を繰り返す

## 3. 実装内容

### 構成
- **index.html**:
  - ページの骨格を定義
  - 「ストリームデータ」「リザーバ」「実行ログ」「操作パネル」の4つの主要エリアを配置
  - Tailwind CSSとGoogle Fontsを使用

### スタイリング
- **Tailwind CSS**: ユーティリティファーストのフレームワークを使用
- **カスタムアニメーション**:
  - replace-animation: リザーバ内の要素置換アニメーション
  - fade-in: ログ追加時のアニメーション
  - highlight-current: 処理中要素のハイライト

### ロジック
- **状態管理**: streamData, reservoir, currentIndex などで状態を管理
- **主要関数**:
  - init(): パラメータ読み込みと初期化
  - step(): アルゴリズムの1ステップ実行
  - toggleRunPause(): 自動実行と一時停止の切り替え
- **UI更新関数**: renderStream(), renderReservoir(), renderLogs()

## 4. 工夫した点・こだわった点

- **確率のリアルタイム表示**: 採用確率(k/i)を常時表示
- **対話的な操作性**: 自動実行、一時停止、ステップ実行、速度調整機能を実装
- **視覚的なフィードバック**: アニメーションによる直感的な状態把握
- **詳細なログ**: 確率的判断過程の可視化

## 5. 【仕様書】リザーバサンプリングの可視化アルゴリズム
________________________________________
■ タイトル： リザーバサンプリング可視化ツール
■ 目的： リザーバサンプリング（Reservoir Sampling）アルゴリズムの動作をリアルタイムで可視化し、ストリームデータからランダムにk個の要素を等確率でサンプルする過程を視覚的に理解できるようにする。
■ 想定ユーザー： - アルゴリズム学習者 - 教育関係者 - データサイエンス初学者
■ 対象アルゴリズム： Reservoir Sampling (k個の要素を選ぶ)
■ 入力： - ストリームデータ（配列もしくは逐次生成されるデータ） - サンプルサイズ k（整数）
■ 出力： - 最終的に選ばれたk個の要素 - 各ステップにおけるリザーバの状態
■ 主要機能： 1. ストリームデータの表示：現在までに到着したデータをリスト形式で表示 2. リザーバの表示：サンプル対象として保持されているk個の要素を常に表示 3. 選択ステップのアニメーション： - 現在の要素が選ばれる確率の表示 - 選ばれた場合のリザーバの入れ替え位置をアニメーションで表示 4. ログ表示：選択のたびにログを残す（例：「i=5: 要素7がインデックス3と入れ替え」） 5. 操作パネル： - ストリームの手動/自動実行の切り替え - スピード調整（例：1x, 2x, 5x） - ストリーム長、kの変更
■ ユーザーインターフェース案： - 画面左：ストリームデータ一覧 - 画面中央：リザーバ（k個）のボックス表示 - 画面右：ログ表示領域 - 下部：操作パネル
■ アルゴリズム概要： 1. 最初のk個はそのままリザーバに格納 2. i番目（i > k）の要素に対して： - j = ランダムに0〜iの整数を選ぶ - j < kならリザーバ[j]をstream[i]で置き換え
■ 使用予定技術： - HTML / CSS / JavaScript - D3.jsまたはp5.js（アニメーション可視化ライブラリ）
■ 拡張予定機能（任意）： - 過去の実行結果の保存と読み込み - 確率分布グラフ表示（要素の選ばれた回数） - リザーバの大きさを動的に変更
■ テストケース： 1. ストリーム：[1,2,3,4,5,6,7,8,9,10]、k=3 2. ストリーム：ランダム生成、長さ=100、k=5
■ 備考： - サンプルが等確率で選ばれることを確認できるよう、繰り返し実行モードを実装して統計的に表示
________________________________________